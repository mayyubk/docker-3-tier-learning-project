# Yeh file Nginx server ke tamam rules ko define karti hai

server {
    # Container ke andar port 80 ko suno
    listen 80;
    
    # 'localhost' se aanay wali requests ka jawab do
    server_name localhost;

    # --- Hissa 1: Frontend (Static Files) ---
    # Yeh block unn tamam requests ko handle karta hai jo '/api/' se shuru NAHI hote
    location / {
        # Woh folder jahan Dockerfile ne index.html copy ki thi
        root   /usr/share/nginx/html;
        
        # Default file jo dikhani hai (agar user sirf / likhe)
        index  index.html;
        
        # Agar koi file na mile toh index.html par wapas bhej do
        try_files $uri $uri/ /index.html;
    }

    # --- Hissa 2: Backend (Reverse Proxy) ---
    # Yeh block unn tamam requests ko pakarta hai jo '/api/' se shuru hote hain
    location /api/ {
        
        # YEH SAB SE ZAROORI FIX HAI:
        # Nginx ko batata hai ke 'backend' jaise naam dhoondne ke liye
        # Docker ka internal DNS (127.0.0.11) istemal kare.
        resolver 127.0.0.11; 

        # YEH DOOSRA ZAROORI FIX HAI:
        # 'backend' naam ko ek variable mein daalta hai.
        # Is se Nginx startup par nahi, balke request aanay par 'backend' ko dhoondta hai.
        set $backend_host backend;
        
        # Request ko 'backend' container (port 5000) par bhej do
        proxy_pass http://$backend_host:5000/; 
        
        # Zaroori headers jo backend ko bhejte hain
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
